generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String        @unique
  name         String
  passwordHash String
  teamId       String?       @db.Uuid
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  transactions Transaction[]
  team         Team?         @relation(fields: [teamId], references: [id])

  @@index([teamId])
}

model Team {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  transactions Transaction[]
  users        User[]
}

model Transaction {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  amount      Decimal   @db.Decimal(10, 2)
  description String
  date        DateTime
  categoryId  String?   @db.Uuid
  userId      String    @db.Uuid
  teamId      String?   @db.Uuid
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  category    Category? @relation(fields: [categoryId], references: [id])
  team        Team?     @relation(fields: [teamId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  @@unique([teamId, date, amount, description])
  @@index([userId])
  @@index([teamId])
  @@index([categoryId])
}

model Category {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  transactions Transaction[]
}
